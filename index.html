<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Bloc de notas</title>
  <style>
    :root{--bg:#f6f8fa;--card:#fff;--accent:#2563eb;--muted:#6b7280}
    html,body{height:100%;margin:0;font-family:Inter, system-ui, -apple-system, 'Segoe UI', Roboto, 'Helvetica Neue', Arial}
    body{background:linear-gradient(180deg,#eef2ff 0%,var(--bg) 60%);display:flex;align-items:center;justify-content:center;padding:24px}
    .app{width:100%;max-width:980px;background:var(--card);box-shadow:0 8px 30px rgba(2,6,23,0.08);border-radius:12px;overflow:hidden}
    header{display:flex;align-items:center;gap:12px;padding:12px 16px;border-bottom:1px solid #f1f5f9}
    .logo{width:40px;height:40px;border-radius:8px;background:linear-gradient(135deg,var(--accent),#7c3aed);display:flex;align-items:center;justify-content:center;color:white;font-weight:700}
    h1{font-size:16px;margin:0}
    .controls{margin-left:auto;display:flex;gap:8px;align-items:center}
    button{background:transparent;border:1px solid #e6edf6;padding:8px 10px;border-radius:8px;font-weight:600;cursor:pointer}
    button.primary{background:var(--accent);color:white;border:none}
    .toolbar{display:flex;gap:8px;padding:12px 16px;border-bottom:1px solid #f1f5f9;align-items:center}
    .filename{color:var(--muted);font-size:13px}
    .editor{padding:12px}
    textarea {width: 100%;height: 60vh;resize: vertical;border: 1px solid #e6edf6;border-radius: 8px;padding: 12px;font-size: 15px;line-height: 1.45;font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, 'Roboto Mono', 'SegoeUI Mono', monospace;background: transparent;box-sizing: border-box;}
    .small{font-size:13px;color:var(--muted)}
    input[type=file]{display:none}
    footer{display:flex;justify-content:space-between;align-items:center;padding:10px 16px;border-top:1px solid #f1f5f9}
    .kb{font-size:12px;color:var(--muted)}
    .toggle{display:flex;align-items:center;gap:8px}
    .chip{background:#f8fafc;padding:6px 8px;border-radius:999px;border:1px solid #eef2f6;font-size:13px}
    /* --- Responsive --- */
@media (max-width: 768px) {
  header {
    flex-wrap: wrap;
    gap: 8px;
  }
  .controls {
    width: 100%;
    justify-content: flex-start;
    flex-wrap: wrap;
  }
  .controls button {
    flex: 1 1 auto;
    min-width: 100px;
  }
  .toolbar {
    flex-wrap: wrap;
    gap: 8px;
  }
  .filename {
    flex-basis: 100%;
  }
  textarea {
    height: 50vh; /* menos alto en móviles */
  }
  h1 {
    font-size: 14px;
  }
}

@media (max-width: 480px) {
  body {
    padding: 12px;
  }
  header {
    padding: 8px;
  }
  .controls button {
    font-size: 13px;
    padding: 6px 8px;
  }
  textarea {
    font-size: 14px;
    padding: 8px;
  }
}

  </style>
</head>
<body>
  <div class="app" role="application">
    <header>
      <div class="logo">NB</div>
      <div>
        <h1>Bloc de notas — simple</h1>
        <div class="small">Guarda y abre archivos .txt fácilmente</div>
      </div>
      <div class="controls">
        <button id="newBtn" title="Nuevo (Ctrl+N)">Nuevo</button>
        <button id="openBtn" title="Abrir (Ctrl+O)">Abrir</button>
        <input id="fileInput" type="file" accept=".txt,text/plain" />
        <button id="renameBtn" title="Cambiar nombre">Renombrar</button>
        <button id="saveBtn" class="primary" title="Guardar (Ctrl+S)">Guardar</button>
        <button id="saveAsBtn" title="Guardar como">Guardar como</button>
      </div>
    </header>

    <div class="toolbar">
      <div class="filename" id="filenameDisplay">Archivo: <span id="filename">sin_nombre.txt</span></div>
      <div style="width:12px"></div>
      <!-- <label class="toggle small"><input type="checkbox" id="autosaveToggle" /> Auto-guardar (local)</label> -->
      <div style="flex:1"></div>
      <div class="chip">Tamaño: <span id="chars">0</span> caracteres</div>
    </div>

    <div class="editor">
      <textarea id="editor" placeholder="Escribe aquí..." spellcheck="false"></textarea>
    </div>

    <footer>
      <div class="kb">Atajos: <strong>Ctrl/Cmd + S</strong> guardar — <strong>Ctrl/Cmd + O</strong> abrir — <strong>Ctrl/Cmd + N</strong> nuevo</div>
      <div class="small">Hecho con ❤️ — Leo</div>
    </footer>
  </div>

  <script>
    // Elementos
    const editor = document.getElementById('editor');
    const saveBtn = document.getElementById('saveBtn');
    const openBtn = document.getElementById('openBtn');
    const fileInput = document.getElementById('fileInput');
    const newBtn = document.getElementById('newBtn');
    const renameBtn = document.getElementById('renameBtn');
    const saveAsBtn = document.getElementById('saveAsBtn');
    const filenameSpan = document.getElementById('filename');
    const filenameDisplay = document.getElementById('filenameDisplay');
    const autosaveToggle = document.getElementById('autosaveToggle');
    const charsSpan = document.getElementById('chars');

    // Estado
    let currentFilename = 'sin_nombre.txt';
    let lastSavedText = '';

    // Utils: descargar texto como archivo
    function downloadText(filename, text) {
      const blob = new Blob([text], { type: 'text/plain' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = filename;
      document.body.appendChild(a);
      a.click();
      a.remove();
      URL.revokeObjectURL(url);
    }

    // Guardar (usa download)
    function saveAsFile() {
      const text = editor.value;
      downloadText(currentFilename, text);
      lastSavedText = text;
      updateStatus();
    }

    // Guardar como (elige nombre)
    function saveAsPrompt(){
      const suggested = currentFilename || 'sin_nombre.txt';
      const name = prompt('Guardar como', suggested);
      if (!name) return;
      currentFilename = name.endsWith('.txt') ? name : name + '.txt';
      filenameSpan.textContent = currentFilename;
      saveAsFile();
    }

    // Abrir archivo: leer contenido de input[file]
    fileInput.addEventListener('change', async (e) => {
      const f = e.target.files[0];
      if (!f) return;
      const text = await f.text();
      editor.value = text;
      currentFilename = f.name || 'sin_nombre.txt';
      filenameSpan.textContent = currentFilename;
      lastSavedText = text;
      updateChars();
      if (autosaveToggle.checked) saveToLocal();
    });

    openBtn.addEventListener('click', () => fileInput.click());
    saveBtn.addEventListener('click', saveAsFile);
    saveAsBtn.addEventListener('click', saveAsPrompt);

    newBtn.addEventListener('click', () => {
      if (editor.value && !confirm('Crear nuevo archivo y perder los cambios no guardados?')) return;
      editor.value = '';
      currentFilename = 'sin_nombre.txt';
      filenameSpan.textContent = currentFilename;
      lastSavedText = '';
      updateChars();
      localStorage.removeItem('simple_notepad_draft');
    });

    // Renombrar archivo
    renameBtn.addEventListener('click', () => {
      const suggested = currentFilename || 'sin_nombre.txt';
      const name = prompt('Nuevo nombre de archivo:', suggested);
      if (!name) return;
      currentFilename = name.endsWith('.txt') ? name : name + '.txt';
      filenameSpan.textContent = currentFilename;
      if (autosaveToggle.checked) saveToLocal();
    });

    // Contador de caracteres
    function updateChars(){
      charsSpan.textContent = editor.value.length;
    }
    editor.addEventListener('input', () => {
      updateChars();
      if (autosaveToggle.checked) debounceSaveLocal();
    });

    // Autosave en localStorage
    function saveToLocal(){
      const payload = { text: editor.value, filename: currentFilename, ts: Date.now() };
      localStorage.setItem('simple_notepad_draft', JSON.stringify(payload));
    }
    function loadFromLocal(){
      try{
        const raw = localStorage.getItem('simple_notepad_draft');
        if (!raw) return false;
        const p = JSON.parse(raw);
        editor.value = p.text || '';
        currentFilename = p.filename || currentFilename;
        filenameSpan.textContent = currentFilename;
        lastSavedText = editor.value;
        updateChars();
        return true;
      }catch(e){return false}
    }

    // Debounce helper
    let debounceTimer = null;
    function debounceSaveLocal(){
      if (debounceTimer) clearTimeout(debounceTimer);
      debounceTimer = setTimeout(() => saveToLocal(), 700);
    }

    // Atajos de teclado
    window.addEventListener('keydown', (e) => {
      const cmd = e.ctrlKey || e.metaKey;
      if (!cmd) return;
      if (e.key.toLowerCase() === 's'){
        e.preventDefault();
        saveAsFile();
      }
      if (e.key.toLowerCase() === 'o'){
        e.preventDefault();
        fileInput.click();
      }
      if (e.key.toLowerCase() === 'n'){
        e.preventDefault();
        newBtn.click();
      }
      if (e.shiftKey && e.key.toLowerCase() === 's'){
        e.preventDefault();
        saveAsPrompt();
      }
    });

    // Inicialización
    function updateStatus(){
      const changed = editor.value !== lastSavedText;
      if (changed) filenameDisplay.title = 'Hay cambios no guardados';
      else filenameDisplay.title = 'Todos los cambios guardados (localmente)';
    }

    // Cargar autosave si existe
    const hadDraft = loadFromLocal();
    if (hadDraft) autosaveToggle.checked = true;
    updateStatus();
    updateChars();

    // Si el usuario intenta cerrar la pestaña con cambios no guardados — alerta
    window.addEventListener('beforeunload', (e) => {
      if (editor.value !== lastSavedText){
        e.preventDefault();
        e.returnValue = '';
      }
    });
  </script>
</body>
</html>
